---
/**
 * SourcesList.astro
 * 
 * Statyczny komponent Astro wyświetlający listę źródeł z linkami do ISAP.
 * Linki otwierają się w nowej karcie z odpowiednimi atrybutami bezpieczeństwa.
 * 
 * @see chat-view-implementation-plan.md section 4.8
 */

import type { SourceReference } from '@/lib/types';

interface Props {
  sources: SourceReference[];
}

const { sources } = Astro.props;

// Walidacja: sprawdzenie czy lista nie jest pusta
const hasSources = sources && sources.length > 0;

// Funkcja pomocnicza do walidacji URL
function isValidUrl(url: string): boolean {
  try {
    new URL(url);
    return true;
  } catch {
    return false;
  }
}
---

{hasSources && (
  <section class="mt-6">
    <h4 class="text-lg font-semibold text-foreground mb-3">
      Źródła
    </h4>
    
    <ul class="space-y-2">
      {sources.map((source) => {
        const isValid = isValidUrl(source.link);
        
        return (
          <li class="flex items-start gap-2">
            <span class="text-muted-foreground">•</span>
            <div class="flex-1 min-w-0">
              {isValid ? (
                <a
                  href={source.link}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-primary hover:underline break-words focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded"
                >
                  <span class="font-medium">{source.act_title}</span>
                  {source.article && (
                    <span class="text-muted-foreground"> - {source.article}</span>
                  )}
                </a>
              ) : (
                <span class="text-foreground">
                  <span class="font-medium">{source.act_title}</span>
                  {source.article && (
                    <span class="text-muted-foreground"> - {source.article}</span>
                  )}
                  <span class="text-muted-foreground text-sm ml-2">(link nieprawidłowy)</span>
                </span>
              )}
            </div>
          </li>
        );
      })}
    </ul>
  </section>
)}

